<!DOCTYPE html>
<html lang="nl">
    
<head>
<meta charset="UTF-8">
<title>Verborgen aanwijzing</title>
    
<style>
body {
    font-family: 'Arial Black', Arial, sans-serif;
    margin: 0;
    height: 100vh;
    background-image: url('Foto%202024.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
}

/* Overlay container voor tekst */
.overlay {
    position: absolute;
    top: 5%;             /* verticale positie vanaf bovenkant */
    left: 50%;            /* horizontaal midden van het scherm */
    transform: translateX(-50%); /* verschuif de div terug zodat hij echt gecentreerd is */
    color: white;
    /* background-color: rgba(255, 0, 0, 0.5); /* halfdoorzichtig rood */
    text-align: center;   /* tekst binnen de overlay gecentreerd */
    text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
    width: 75%;
    max-width: 100%;        /* voorkomt dat tekst te breed wordt */
}

/* Titel */
h1 {
    font-size: 4em;
    margin-bottom: 0.5em;
}

/* Countdown */
#countdown {
    font-size: 4.5em;
    font-weight: bold;
    letter-spacing: 0.05em;
    animation: pulse 1s infinite alternate;
}

/* Pulse animatie */
@keyframes pulse {
    from { transform: scale(1); }
    to { transform: scale(1.05); }
}

/* Bericht */
#message {
    margin-top: 15px;
    font-size: 2.5em;
    text-shadow: 1px 1px 5px rgba(0,0,0,0.3);
    max-width: 100%;          /* tekst mag maximaal 80% van overlay zijn */
    word-wrap: break-word;   /* lange woorden breken indien nodig */
    text-align: center;      /* tekst gecentreerd */
    line-height: 1.4em;      /* iets meer ruimte tussen regels voor leesbaarheid */
}

/* Media queries voor kleinere schermen */
@media (max-width: 768px) { /* tablets */
    h1 { font-size: 2.8em; }
    #countdown { font-size: 3em; }
    #message { font-size: 2em; }
}

@media (max-width: 480px) { /* smartphones */
    .overlay { top: 5%; left: 5%; }
    h1 { font-size: 2em; }
    #countdown { font-size: 2.3em; }
    #message { font-size: 1.5em; }
}
</style>
    
<script>
const redirectURL = 'https://bbfl.formaloo.co/bbfl_aanwijzing';
const targetISO = '2025-11-01T22:30:00+02:00'; // doeltijd in Brussels/UTC+2
let offset = 0; // ms: serverTime - Date.now()
let lastSync = 0;
const SYNC_INTERVAL_MS = 5 * 60 * 1000; // elke 5 minuten opnieuw synchroniseren

// Haal betrouwbare tijd op en corrigeer voor netwerk-latency (halve RTT)
async function syncTimeWithServer() {
  try {
    const t0 = Date.now();
    const resp = await fetch('https://worldtimeapi.org/api/timezone/Europe/Brussels', { cache: 'no-store' });
    const t1 = Date.now();

    if (!resp.ok) throw new Error('API niet bereikbaar: ' + resp.status);

    const data = await resp.json();
    // data.datetime is ISO string met offset; convert naar ms
    const serverMs = new Date(data.datetime).getTime();

    // geschatte lokale tijd tijdens server timestamp = midpoint van t0 en t1
    const localMidpoint = Math.floor((t0 + t1) / 2);

    offset = serverMs - localMidpoint;
    lastSync = Date.now();
    console.log('Tijd gesynchroniseerd. offset (ms):', offset, 'latency (ms):', t1 - t0);
    return true;
  } catch (err) {
    console.error('syncTimeWithServer fout:', err);
    return false;
  }
}

function nowCorrected() {
  // gebruik huidige lokale tijd + offset (offset kan 0 zijn bij fallback)
  return Date.now() + offset;
}

function formatTimePart(n) {
  return n.toString().padStart(2, '0');
}

function updateCountdown() {
  const targetMs = new Date(targetISO).getTime();
  const nowMs = nowCorrected();
  const diff = targetMs - nowMs;

  if (diff <= 0) {
    // bereikt of gepasseerd -> redirect
    // kleine safety: forceer nog een korte delay zodat gebruikers zien 00:00:00
    document.getElementById('countdown').textContent = '00 : 00 : 00';
    setTimeout(() => { window.location.href = redirectURL; }, 500);
    return;
  }

  const totalSeconds = Math.floor(diff / 1000);
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = Math.floor(totalSeconds % 60);

  document.getElementById('countdown').textContent =
    `${formatTimePart(hours)} : ${formatTimePart(minutes)} : ${formatTimePart(seconds)}`;

  // (optioneel) aangepaste berichttekst
  document.getElementById('message').textContent =
    'Jullie zijn te vroeg, er wordt nog volop gezocht op deze plaats door de politie. Kom terug wanneer de politie deze zone vrijgegeven heeft!';
}

async function startCountdown() {
  // Eerste synchronisatie; als faalt -> offset blijft 0 en we vallen terug op lokale tijd
  const ok = await syncTimeWithServer();
  if (!ok) {
    document.getElementById('message').textContent = 'Kon de tijd niet verifiëren, lokale tijd wordt gebruikt.';
    offset = 0;
  }

  // update loop: elke seconde de display updaten (maar berekeningen op basis van Date.now()+offset)
  updateCountdown();
  // gebruik setInterval voor visuele updates
  const uiInterval = setInterval(updateCountdown, 1000);

  // periodieke resync met server
  const resyncInterval = setInterval(async () => {
    const success = await syncTimeWithServer();
    if (!success) {
      // laat offset onveranderd (maar kan loggen). probeer later weer.
      console.warn('Resync mislukt — blijf huidige offset gebruiken.');
    } else {
      // direct update UI na succesvolle resync
      updateCountdown();
    }
  }, SYNC_INTERVAL_MS);

  // optioneel: wanneer de pagina zichtbaar wordt (bijvoorbeeld na slaap/resume), forceer directe update/resync
  document.addEventListener('visibilitychange', async () => {
    updateCountdown(); // snelle refresh
    if (document.visibilityState === 'visible') {
      // bij terugkeer naar voorgrond: probeer snel synchroniseren (niet blokkeren)
      await syncTimeWithServer();
      updateCountdown();
    }
  });

  // tidy-up wanneer pagina unload (niet strikt nodig)
  window.addEventListener('beforeunload', () => {
    clearInterval(uiInterval);
    clearInterval(resyncInterval);
  });
}

window.onload = startCountdown;
</script>


    
</head>
    
<body>
  <div class="overlay">
    <h1>Verborgen aanwijzing</h1>
    <div id="countdown">-- : -- : --</div>
    <div id="message">
      Jullie zijn te vroeg, er wordt nog volop gezocht op deze plaats door de politie. Kom terug wanneer de politie deze zone vrijgegeven heeft!
    </div>
  </div>
</body>

























